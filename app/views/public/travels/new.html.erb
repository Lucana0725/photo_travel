<h1>Let's Create Your New Travel!</h1>

<%= form_with model: @travel, url: travels_path, method: :post do |f| %>
  <div>
    <%= f.label :image, "画像" %></br>
    <%= f.file_field :image %>
  </div>
  <div>
    <%= f.label :title, "投稿タイトル" %></br>
    <%= f.text_field :title %>
  </div>
  <div>
    <%= f.label :body, "内容" %></br>
    <%= f.text_area :body %>
  </div>
  <!--マップ-->
  <div>
    <%= f.label :map, "住所入力" %></br>
    <%= f.text_field :address %>  <!--住所入力欄-->
    <%= f.hidden_field :latitude %>  <!--緯度を取得できるようにする(デベロッパーツールで地図(住所入力欄)をクリックするとhiddenのidのところに自動的に(Model名 + 指定カラム名)が入る仕組みになっている。)-->
    <%= f.hidden_field :longitude %>
  </div>
  <!--マップの表示-->
  <div id="map"></div>

  <%= f.submit "投稿する" %>
<% end %>

<style>
  #map {
    height: 500px;
    width: 600px;
  }
</style>

<script>
  var marker
  var myLatLng
  var map
  var map_lat
  var map_lng

  function initMap(){
     myLatLng = {lat: 35.68090045006303, lng: 139.76690798417752}
     marker = new google.maps.Marker();

     // デベロッパーツールで地図(住所入力欄)をクリックするとhiddenのidのところに自動的に(Model名 + form_withでの指定カラム名(今回は:latitude, :longitude))が入る仕組みになっている。これを使用してgetElementByIdのidを指定する。
    map_lat = document.getElementById('travel_latitude')  // < form_with >の< f.hidden_field >で取得したlatitudeを取得、map_latで保持。
    map_lng = document.getElementById('travel_longitude')  // < form_with >の< f.hidden_field >で取得したlatitudeを取得、map_lngで保持。
     map = new google.maps.Map(document.getElementById('map'), {
    center: myLatLng,
    zoom: 12
    });

   google.maps.event.addListener(map, 'click', mylistener);

      //クリックしたときの処理
    function mylistener(event){
      //markerの位置を設定
      //event.latLng.lat()でクリックしたところの緯度を取得
      marker.setPosition(new google.maps.LatLng(event.latLng.lat(), event.latLng.lng()));
      //marker設置
      marker.setMap(map);
      map_lat.value = event.latLng.lat();
      map_lng.value = event.latLng.lng();
    }
  }
  function deleteMarker(){
    marker.setMap(null);
    map_lat.value = "";
    map_lng.value = "";
  }



</script>
<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=<%= ENV['GOOGLE_API_KEY'] %>&callback=initMap" async defer></script>


